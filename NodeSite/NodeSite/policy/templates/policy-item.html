{% extends 'base.html' %}
{% load compressed %}

{% block extra_css %}
{% compressed_css 'policy' %}
{% endblock%}

{% block content %}
<h1>策略：{{policy_id}}</h1>

<!-- description rules -->
<section class="panel panel-default">
  <h3>策略的具体情况</h3>
  <div id="policy"></div> 
</section>

<!-- now policy -->
<section id="policy-now-section" class="panel panel-default" style="position: relative">
  <h3>正在被执行的情况</h3>
  <div id="policy-now" class="policy"></div> 
  {% include 'policy-now-template.html' %}
</section>

<!-- plan policy -->
<section class="panel panel-default" id="policy-plan-section">
  <h3>计划中的策略执行安排</h3>
  <div id="policy-plan">
    <form class="form form-inline" role="form" name="post-form">
      <div class="form-group">
        <label class="sr-only" for="room-desc">房间号</label>
        <input data-api="mr-dropdown" type="text" class="form-control" id="room-desc" name="roomDesc" placeholder="房间名称" value="{{roomDesc}}">
      </div>
      <div class="form-group">
        <label class="sr-only" for="plantName">植物名称</label>
        <input data-api="mr-dropdown" type="text" class="form-control" id="plant-name" name="plantName" placeholder="植物名称" value="{{plantName}}">
      </div>
      <div class="form-group">
        <label class="sr-only" for="start-date">运行起始时间</label>
        <input type="date" class="form-control datepicker" id="start-date" name="startDate" placeholder="运行起始时间" style="display: block" value="{{startDate}}">
      </div>
      <div class="form-group">
        <label class="sr-only" for="start-date">运行起始时间</label>
        <input type="time" class="form-control timepicker" id="start-time" name="startTime" placeholder="运行起始时间" style="display: block" value="{{startTime}}">
      </div>
      <button type="submit" name="post" class="btn btn-success">提交</button>
    </form>
  </div> 

  <div id="policy-plan-list-wrapper" class="policy-plan-list">
    <ul id="policy-plan-list"> </ul>
    <!-- 模板 -->
    <script id="policy-plan-template" type="text/x-handlebars-template">
      {% verbatim %} 
      {{#each plan}}
      <li policy-instance-id={{policyInstanceId}} class="well">
        <p>房间：
          <span>{{roomDesc}}</span>
          <input data-api="mr-dropdown" type="text" name="roomDesc" value="{{roomDesc}}" style="display:none"/>
        </p>
        <p>植物：
          <span>{{plantName}}</span>
          <input data-api="mr-dropdown" type="text" name="plantName" value="{{plantName}}" style="display:none"/>
        </p>
        <p>执行时间：
          <span>{{startDate}} {{startTime}}{{startAt}}</span>
          <!-- <input type="text" name="startAt" value="{{startDate}} {{startTime}}{{startAt}}" style="display:none"/> -->
          <input type="date" class="datepicker" id="start-date" name="startDate" placeholder="运行起始时间" style="display: none" data-value="{{startDate}}">
          <input type="time" class="timepicker" id="start-time" name="startTime" placeholder="运行起始时间" style="display: none" data-value="{{startTime}}">
        </p>          
        <button type="button" class="close" action="remove" ><i class="glyphicon glyphicon-remove"></i></button>
        <button type="button" class="close" action="editing" ><i class="glyphicon glyphicon-pencil"></i></button>
      </li>
      {{/each}}
      {% endverbatim %} 
    </script>
  </div> 
  <script id="dropdown-template" type="text/x-handlebars-template">
  {% verbatim %} 
  <div class="dropdown open">
    <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu1">
      {{#each rooms}}
      <li role="presentation" mr-id="{{@key}}" >
        <!-- "float:left"让button能够和a在同一行上面 -->
        <a role="menuitem" tabindex="-1" href="javascript:void(0)" style="float: left">
          {{this}}
        </a>
        {{#if ../isShow}}
        <button type="button" class="close" action="remove-plantname" ><i class="glyphicon glyphicon-remove"></i></button>
        <button type="button" class="close" action="edit-plantname" ><i class="glyphicon glyphicon-pencil"></i></button>
        {{/if}}
      </li>
      {{/each}}
    </ul>
  </div>
  {% endverbatim %} 
  </script>

</section>

<!-- old policy -->
<section  class="panel panel-default" >
  <h3>策略历来执行情况</h3>
  <div id="output-area">
    <!-- <form id="output-form" class="form" method="POST" action="/policy/save/output/" enctype="multipart/form-data" style="width: 21%;"> -->
    <!--   {% csrf_token %}  -->
    <!--   <input type="hidden" name="policy_id" value="{{policy_id}}" /> -->
    <!--   <input type="hidden" name="pre_url" value="{{request.path}}" /> -->
    <!--   <div class="form-group"> -->
    <!--     <label for="output">产出值(保留两位小数)</label> -->
    <!--     <input type="number" step="0.01" class="form-control" id="output" name="output" placeholder="产出值（保留两位小数）"> -->
    <!--   </div> -->
    <!--   <div class="form-group"> -->
    <!--     <label for="inputFile">上传图片</label> -->
    <!--     <input type="file" id="inputFile" name="image"> -->
    <!--     <p class="help-block">养殖成果图片</p> -->
    <!--   </div> -->
    <!--   <button type="submit" class="btn btn-default">提交</button> -->
    <!-- </form> -->
    
    <ul id="policy-done-list">
      {% for v in values %}
      <li output-id={{v.id}}>
        <button type="button" class="close" action="remove" ><i class="glyphicon glyphicon-remove"></i></button>
        <p>产出值: {{v.output}}</p>
        <img src="{{v.image}}" class="" alt="" />
      </li>
      {% endfor %}
    </ul>
    <script id="policy-done-template" type="text/x-handlebars-template">
      {% verbatim %} 
      {{#each done}}
      <li policy-instance-id={{policyInstanceId}}>
        <p>房间：{{roomDesc}}</p>
        <p>植物：{{plantName}}</p>
        <p>执行时间：{{startDate}} {{startTime}}{{startAt}}</p>          
        <p class="output">产出值: 
          <span>{{#if output}}{{output}}{{/if}}
          {{#if output}}
          <button type="button" class="close" action="edit-output" >
            <i class="glyphicon glyphicon-pencil"></i>
          </button>
          {{/if}}
          </span>
          <form action="save-output" class="form form-inline" {{#if output}} style="display:none" {{/if}}>
            <input type="number" step="0.01" class="form-control" id="output" name="output" placeholder="产出值（保留两位小数）">          
            <button type="submit" class="btn btn-success">确认</button>
          </form>
        </p>
        <p>附加图片：
          {{#if image}}
          <button type="button" class="close" action="edit-image" >
            <i class="glyphicon glyphicon-pencil"></i>
          </button>
          <img src="{{image}}" class="" alt="" />
          {{/if}}
          <form type="save-image" action="/policy/instance/{{policyInstanceId}}/image/save/" method="POST" enctype="multipart/form-data" class="form form-inline" {{#if image}} style="display:none" {{/if}}>
            {% endverbatim %} 
            {% csrf_token %} 
            <input type="hidden" name="pre_url" value="{{request.path}}" />
            {% verbatim %} 
            <input type="file" id="inputFile" name="image">          
            <button type="submit" class="btn btn-success">确认</button>
          </form>

        </p>
      </li>
      {{/each}}
      {% endverbatim %} 
    </script>

  </div> 
</section>

{% compressed_css 'picker' %}
{% compressed_js 'picker' %}

{% include 'policy-script.html' %}
{% compressed_js 'policy' %}
{% compressed_js 'policy_item' %}

{% endblock %}
