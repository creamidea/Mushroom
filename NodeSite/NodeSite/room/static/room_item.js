// Generated by CoffeeScript 1.7.1
'use strict';
$(function() {
  var $oneHourArea, data, data_2, data_test, i, roomId, searchChart, stream_index, stream_layers, stream_waves, _i;
  console.log("here is room item");
  roomId = window.location.pathname.split("/")[2];
  $("#create-new-policy-model").on('shown.bs.modal', function(e) {
    return getPolicyList({
      $renderTo: $("#create-new-policy-model .modal-body")
    });
  });
  getRoom(roomId);
  requestData(roomId);
  $oneHourArea = $('#realtime-chart');
  getDataFromS({
    url: "/data/room/" + roomId + "/",
    requestData: {
      startTime: "809-1382490182",
      endTime: "4u321849014"
    },
    callback: function(data) {
      var datapkg, html, key, _results;
      datapkg = dataPkgForD3(data.body);
      html = renderRTChart(datapkg);
      $oneHourArea.append(html);
      _results = [];
      for (key in datapkg) {
        data = datapkg[key];
        _results.push(drawLineChart({
          elt: "#" + key + " svg",
          data: data,
          xLabel: key,
          yLabel: "采集值"
        }));
      }
      return _results;
    }
  });
  searchChart = new SearchChart({
    $renderTo: $("#search-chart-area"),
    roomId: roomId
  });
  console.log(searchChart);
  searchChart.render();
  data = function() {
    return stream_layers(3, 10 + Math.random() * 200, .1).map(function(data, i) {
      return {
        key: 'Stream' + i,
        values: data
      };
    });
  };
  stream_layers = function(n, m, o) {
    var bump;
    if (arguments.length < 3) {
      o = 0;
    }
    bump = function(a) {
      var i, w, x, y, z, _i, _results;
      x = 1 / (.1 + Math.random());
      y = 2 * Math.random() - .5;
      z = 10 / (.1 + Math.random());
      _results = [];
      for (i = _i = 0; 0 <= m ? _i <= m : _i >= m; i = 0 <= m ? ++_i : --_i) {
        w = (i / m - y) * z;
        _results.push(a[i] += x * Math.exp(-w * w));
      }
      return _results;
    };
    return d3.range(n).map(function() {
      var a, i, _i, _j;
      a = [];
      for (i = _i = 0; 0 <= m ? _i <= m : _i >= m; i = 0 <= m ? ++_i : --_i) {
        a[i] = o + o * Math.random();
      }
      for (i = _j = 0; _j <= 5; i = ++_j) {
        bump(a);
      }
      return a.map(stream_index);
    });
  };
  stream_waves = function(n, m) {
    return d3.range(n).map(function(i) {
      return d3.range(m).map(function(j) {
        var x;
        x = 20 * j / m - i / 3;
        return 2 * x * Math.exp(-.5 * x);
      }).map(stream_index);
    });
  };
  stream_index = function(d, i) {
    return {
      x: i,
      y: Math.max(0, d)
    };
  };
  data_2 = {
    key: "test1",
    values: []
  };
  for (i = _i = 1; _i <= 1000; i = ++_i) {
    data_2.values.push({
      x: i,
      y: i * Math.random() * 100 - 20
    });
  }
  data_test = [data_2];
  drawLineWithFocusChart({
    data: data_test,
    elt: "#line-with-focus-chart svg",
    xLabel: "采集时间",
    yLabel: "采集值"
  });
});
